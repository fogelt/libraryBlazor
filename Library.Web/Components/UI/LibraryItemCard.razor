@using Library.Core.Models.Items

<div class="card h-100 glass-card border-0 overflow-hidden position-relative" @onclick="HandleClick"
     style="cursor: pointer;">
  <div class="item-crescent-container">
    @if (!string.IsNullOrEmpty(Item.ImageUrl))
    {
      <img src="@Item.ImageUrl" alt="@Item.Title" class="crescent-img" />
    }
    else
    {
      <div class="crescent-img d-flex align-items-center justify-content-center bg-white bg-opacity-10">
        <i class="bi bi-book opacity-25 text-white fs-1"></i>
      </div>
    }
    <div class="crescent-overlay"></div>
  </div>

  <div class="card-body d-flex flex-column z-1" style="max-width: 70%;">
    <div class="d-flex align-items-center gap-2 mb-2">
      <span class="text-uppercase fw-bold opacity-50" style="font-size: 0.55rem; letter-spacing: 0.1em;">
        @Item.GetType().Name
      </span>
      <span class="opacity-25" style="font-size: 0.55rem;">|</span>
      <span class="opacity-50" style="font-size: 0.55rem; letter-spacing: 0.05em;">@Item.ISBN</span>
    </div>

    <h5 class="card-title fw-bold text-white mb-1 text-truncate">@Item.Title</h5>
    <h6 class="card-subtitle opacity-75 small">@Item.Author â€¢ @Item.PublishedYear</h6>

    <span class="opacity-50 mb-3" style="font-size: 0.65rem; letter-spacing: 0.1em;">
      @if (Item is DVD d)
      {
        <i class="bi bi-clock me-1"></i>
        @(d.DurationInSeconds / 60) @("m")
      }
      else if (Item is Magazine m)
      {

        <text>Issue #@m.IssueNumber</text>
      }
      else if (Item is Book b)
      {

        <text>@b.NumberOfPages Pages</text>
      }
    </span>


    <div>
      <span class="opacity-50 fw-bold d-flex align-items-center"
            style="font-size: 0.65rem; letter-spacing: 0.05em; text-transform: uppercase;">
        <i class="bi @(Item.IsAvailable ? "bi-check2" : "bi-x") me-1" </i>
        @(Item.IsAvailable ? "In Stock" : "Out of Stock")
      </span>
    </div>
  </div>

  <div class="card-footer bg-transparent border-0 pb-3 z-1">
    <button class="btn btn-sm text-white opacity-50 hover-opacity-100 p-0 border-0 shadow-none"
            style="font-size: 0.75rem;">
      View Details <i class="bi bi-chevron-right ms-1"></i>
    </button>
  </div>
</div>

@code {
  [Parameter][EditorRequired] public LibraryItem Item { get; set; } = default!;
  [Parameter] public EventCallback<LibraryItem> OnPressed { get; set; }

  private async Task HandleClick()
  {
    if (OnPressed.HasDelegate) await OnPressed.InvokeAsync(Item);
  }
}