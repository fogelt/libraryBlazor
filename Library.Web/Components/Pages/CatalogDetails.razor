@rendermode InteractiveServer

@page "/catalog/{Id}"
@using Library.Core.Models.Items
@using Library.Web.Services
@inject LibraryService LibraryService
@inject NavigationManager Navigation

<PageTitle>@(item?.Title ?? "Loading...")</PageTitle>

<div class="container mt-4">
  <button class="btn btn-sm text-white opacity-50 hover-opacity-100 mb-3 p-0 border-0 shadow-none" @onclick="GoBack"
          style="outline: none;">
    <i class="bi bi-arrow-left me-2"></i>Back to Catalog
  </button>

  @if (item == null)
  {
    <div class="glass-card p-4 text-center">
      <div class="spinner-border spinner-border-sm text-light opacity-25"></div>
    </div>
  }
  else
  {
    <div class="glass-card p-4 border-white border-opacity-10 shadow-lg">
      <div class="row g-4 align-items-stretch">

        <div class="col-md-3">
          @if (!string.IsNullOrEmpty(item.ImageUrl))
          {
            <img src="@item.ImageUrl" class="rounded shadow-lg img-fluid border border-white border-opacity-10"
                 alt="@item.Title" />
          }
          else
          {
            <div
              class="rounded bg-white bg-opacity-10 d-flex align-items-center justify-content-center border border-white border-opacity-10"
              style="aspect-ratio: 3/4; font-size: 3rem;">
              <i class="bi bi-book opacity-25 text-white"></i>
            </div>
          }
        </div>

        <div class="col-md-9 text-white d-flex flex-column">
          <div class="mb-3">
            <h2 class="fw-bold m-0 @(item.IsAvailable ? "" : "opacity-50")">
              @item.Title
            </h2>
            <p class="opacity-50 mb-0">by @item.Author</p>
            <p class="opacity-50 mb-0" style="font-size: 10px">@item.ISBN</p>
          </div>

          <div class="d-flex flex-wrap gap-2 mb-4">
            <div
              class="glass-card border border-white border-opacity-10 px-3 py-1 bg-white bg-opacity-5 d-flex align-items-center">
              <i class="bi bi-calendar3 opacity-50 me-2" style="font-size: 0.75rem;"></i>
              <span class="small fw-light opacity-75">@item.PublishedYear</span>
            </div>

            @if (!item.IsAvailable)
            {
              <span
                class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 px-3 d-flex align-items-center justify-content-center"
                style="font-size: 0.6rem; letter-spacing: 0.05em; text-transform: uppercase; font-weight: 700;">
                Out of Stock
              </span>
            }
            else
            {
              <span
                class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-3 d-flex align-items-center justify-content-center"
                style="font-size: 0.6rem; letter-spacing: 0.05em; text-transform: uppercase; font-weight: 700;">
                In Stock
              </span>
            }
          </div>

          <p class="small opacity-75 mb-4" style="max-width: 600px; line-height: 1.6;">
            @item.Description
          </p>

          <div class="mt-auto pt-3">
            <button class="btn btn-sm glass-card fw-bold px-4 py-2 text-white border-white border-opacity-10"
                    @onclick="GoToLoans">
              Manage Loan
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</div>

@code {
  [Parameter] public string Id { get; set; } = default!;
  private LibraryItem? item;

  protected override async Task OnInitializedAsync() =>
      item = await LibraryService.GetLibraryItemAsync(Id);

  private void GoBack() => Navigation.NavigateTo("/catalog/");
  private void GoToLoans() => Navigation.NavigateTo("/loans/");
}